
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WillpowerFitness AI</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }
      * {
        box-sizing: border-box;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useRef } = React;

      // API base URL - adjust this if needed
      const API_BASE = window.location.origin;

      function Login({ onLogin }) {
        const [name, setName] = useState('');
        const [goal, setGoal] = useState('');
        const [loading, setLoading] = useState(false);

        const handleSubmit = async (e) => {
          e.preventDefault();
          if (!name.trim() || !goal.trim()) return;
          
          setLoading(true);
          try {
            const user_id = 'user_' + Date.now();
            const response = await fetch(`${API_BASE}/api/onboard`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                user_id,
                name: name.trim(),
                goal: goal.trim(),
                source: 'website'
              })
            });

            if (response.ok) {
              const data = await response.json();
              onLogin({ user_id, name: name.trim(), goal: goal.trim(), welcomeMessage: data.message });
            } else {
              alert('Failed to set up your profile. Please try again.');
            }
          } catch (error) {
            console.error('Onboard error:', error);
            alert('Connection error. Please check your internet and try again.');
          } finally {
            setLoading(false);
          }
        };

        return React.createElement('div', {
          style: {
            maxWidth: '400px',
            margin: '0 auto',
            backgroundColor: 'rgba(255,255,255,0.95)',
            padding: '2rem',
            borderRadius: '10px',
            boxShadow: '0 10px 30px rgba(0,0,0,0.2)'
          }
        },
          React.createElement('form', { onSubmit: handleSubmit }, [
            React.createElement('div', {
              key: 'name-field',
              style: { marginBottom: '1rem' }
            }, [
              React.createElement('label', {
                key: 'name-label',
                style: { display: 'block', marginBottom: '0.5rem', fontWeight: 'bold' }
              }, 'Your Name:'),
              React.createElement('input', {
                key: 'name-input',
                type: 'text',
                value: name,
                onChange: (e) => setName(e.target.value),
                placeholder: 'Enter your first name',
                style: {
                  width: '100%',
                  padding: '0.75rem',
                  border: '2px solid #ddd',
                  borderRadius: '5px',
                  fontSize: '1rem'
                }
              })
            ]),

            React.createElement('div', {
              key: 'goal-field',
              style: { marginBottom: '1.5rem' }
            }, [
              React.createElement('label', {
                key: 'goal-label',
                style: { display: 'block', marginBottom: '0.5rem', fontWeight: 'bold' }
              }, 'Fitness Goal:'),
              React.createElement('input', {
                key: 'goal-input',
                type: 'text',
                value: goal,
                onChange: (e) => setGoal(e.target.value),
                placeholder: 'e.g., lose weight, build muscle, get stronger',
                style: {
                  width: '100%',
                  padding: '0.75rem',
                  border: '2px solid #ddd',
                  borderRadius: '5px',
                  fontSize: '1rem'
                }
              })
            ]),

            React.createElement('button', {
              key: 'submit-btn',
              type: 'submit',
              disabled: loading || !name.trim() || !goal.trim(),
              style: {
                width: '100%',
                padding: '0.75rem',
                backgroundColor: loading || !name.trim() || !goal.trim() ? '#ccc' : '#007bff',
                color: 'white',
                border: 'none',
                borderRadius: '5px',
                fontSize: '1.1rem',
                cursor: loading || !name.trim() || !goal.trim() ? 'not-allowed' : 'pointer',
                fontWeight: 'bold'
              }
            }, loading ? 'Setting up...' : 'Start Training! 💪')
          ])
        );
      }

      function ChatBox({ user }) {
        const [messages, setMessages] = useState([]);
        const [input, setInput] = useState('');
        const [loading, setLoading] = useState(false);
        const messagesEndRef = useRef(null);

        useEffect(() => {
          if (user.welcomeMessage) {
            setMessages([{
              sender: 'ai',
              text: user.welcomeMessage,
              timestamp: new Date().toLocaleTimeString()
            }]);
          }
        }, [user.welcomeMessage]);

        useEffect(() => {
          messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
        }, [messages]);

        const sendMessage = async (e) => {
          e.preventDefault();
          if (!input.trim() || loading) return;

          const userMessage = {
            sender: 'user',
            text: input.trim(),
            timestamp: new Date().toLocaleTimeString()
          };

          setMessages(prev => [...prev, userMessage]);
          const messageText = input.trim();
          setInput('');
          setLoading(true);

          try {
            const response = await fetch(`${API_BASE}/api/chat`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                message: messageText,
                user_id: user.user_id
              })
            });

            if (response.ok) {
              const data = await response.json();
              const aiMessage = {
                sender: 'ai',
                text: data.reply,
                timestamp: new Date().toLocaleTimeString()
              };
              setMessages(prev => [...prev, aiMessage]);
            } else {
              const errorMessage = {
                sender: 'ai',
                text: 'Sorry, I had trouble processing that. Please try again.',
                timestamp: new Date().toLocaleTimeString()
              };
              setMessages(prev => [...prev, errorMessage]);
            }
          } catch (error) {
            console.error('Chat error:', error);
            const errorMessage = {
              sender: 'ai',
              text: 'Connection error. Please check your internet and try again.',
              timestamp: new Date().toLocaleTimeString()
            };
            setMessages(prev => [...prev, errorMessage]);
          } finally {
            setLoading(false);
          }
        };

        return React.createElement('div', {
          style: {
            maxWidth: '800px',
            margin: '0 auto',
            backgroundColor: 'rgba(255,255,255,0.95)',
            borderRadius: '10px',
            overflow: 'hidden',
            boxShadow: '0 10px 30px rgba(0,0,0,0.2)',
            height: '500px',
            display: 'flex',
            flexDirection: 'column'
          }
        }, [
          React.createElement('div', {
            key: 'messages-container',
            style: {
              flex: 1,
              overflowY: 'auto',
              padding: '1rem'
            }
          }, [
            ...messages.map((msg, index) =>
              React.createElement('div', {
                key: index,
                style: {
                  marginBottom: '1rem',
                  display: 'flex',
                  justifyContent: msg.sender === 'user' ? 'flex-end' : 'flex-start'
                }
              },
                React.createElement('div', {
                  style: {
                    maxWidth: '70%',
                    padding: '0.75rem',
                    borderRadius: '18px',
                    backgroundColor: msg.sender === 'user' ? '#007bff' : '#f1f1f1',
                    color: msg.sender === 'user' ? 'white' : 'black'
                  }
                }, [
                  React.createElement('div', {
                    key: 'text',
                    style: { marginBottom: '0.25rem' }
                  }, msg.text),
                  React.createElement('div', {
                    key: 'timestamp',
                    style: {
                      fontSize: '0.8rem',
                      opacity: 0.7,
                      textAlign: 'right'
                    }
                  }, msg.timestamp)
                ])
              )
            ),
            
            loading && React.createElement('div', {
              key: 'loading',
              style: { textAlign: 'center', color: '#666' }
            }, React.createElement('em', null, 'Will Power is typing...')),
            
            React.createElement('div', {
              key: 'scroll-anchor',
              ref: messagesEndRef
            })
          ]),

          React.createElement('form', {
            key: 'input-form',
            onSubmit: sendMessage,
            style: { padding: '1rem' }
          },
            React.createElement('div', {
              style: { display: 'flex', gap: '0.5rem' }
            }, [
              React.createElement('input', {
                key: 'message-input',
                type: 'text',
                value: input,
                onChange: (e) => setInput(e.target.value),
                placeholder: 'Ask about workouts, nutrition, motivation...',
                disabled: loading,
                style: {
                  flex: 1,
                  padding: '0.75rem',
                  border: '2px solid #ddd',
                  borderRadius: '25px',
                  fontSize: '1rem',
                  outline: 'none'
                }
              }),
              React.createElement('button', {
                key: 'send-btn',
                type: 'submit',
                disabled: loading || !input.trim(),
                style: {
                  padding: '0.75rem 1.5rem',
                  backgroundColor: loading || !input.trim() ? '#ccc' : '#28a745',
                  color: 'white',
                  border: 'none',
                  borderRadius: '25px',
                  cursor: loading || !input.trim() ? 'not-allowed' : 'pointer',
                  fontWeight: 'bold'
                }
              }, 'Send')
            ])
          )
        ]);
      }

      function App() {
        const [user, setUser] = useState(null);

        return React.createElement('div', {
          style: { 
            minHeight: '100vh',
            padding: '2rem', 
            fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'
          }
        }, [
          React.createElement('div', {
            key: 'header',
            style: { textAlign: 'center', marginBottom: '2rem' }
          }, [
            React.createElement('div', {
              key: 'logo-header',
              style: { display: 'flex', alignItems: 'center', justifyContent: 'center', marginBottom: '0.5rem' }
            }, [
              React.createElement('img', {
                key: 'logo',
                src: '/attached_assets/WillPowerFitness Profile Image_1751335061013.png',
                alt: 'WillpowerFitness Logo',
                style: { 
                  height: '80px', 
                  marginRight: '1rem',
                  filter: 'drop-shadow(2px 2px 4px rgba(0,0,0,0.3))'
                }
              }),
              React.createElement('h1', {
                key: 'title',
                style: { 
                  fontSize: '2.5rem', 
                  margin: '0',
                  color: 'white',
                  fontWeight: 'bold',
                  textShadow: '2px 2px 4px rgba(0,0,0,0.3)'
                }
              }, 'AI Coach')
            ]),
            React.createElement('p', {
              key: 'subtitle',
              style: { fontSize: '1.2rem', color: 'rgba(255,255,255,0.9)', margin: 0 }
            }, 'Your Personal AI Fitness Coach')
          ]),

          !user ? 
            React.createElement(Login, { key: 'login', onLogin: setUser }) :
            React.createElement('div', { key: 'chat-container' }, [
              React.createElement('div', {
                key: 'controls',
                style: { textAlign: 'center', marginBottom: '1rem' }
              },
                React.createElement('button', {
                  onClick: () => setUser(null),
                  style: {
                    padding: '0.5rem 1rem',
                    backgroundColor: 'rgba(255,255,255,0.2)',
                    color: 'white',
                    border: '2px solid white',
                    borderRadius: '20px',
                    cursor: 'pointer',
                    fontSize: '0.9rem',
                    fontWeight: 'bold'
                  }
                }, '← Start Over')
              ),
              React.createElement(ChatBox, { key: 'chatbox', user: user })
            ])
        ]);
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(React.createElement(App));
    </script>
  </body>
</html>
